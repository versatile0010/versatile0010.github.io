---
title: " π” Enhancing API Security with RSA Encryption in Spring/Java and Redis "
layout: single
classes: wide
categories:
  - Security
---

### μ„λΉ„μ¤λ¥Ό κ°λ°ν•  λ•, μ„±λ¥μ μΈ κ³ λ―Όλ„ λ¶„λ… ν•„μ”ν•μ§€λ§ API ν†µμ‹ μ— μ΄μ©λλ” κ³ κ°μ λ―Όκ°μ •λ³΄λ¥Ό μ–΄λ–»κ² ν•λ©΄ λ” μ μ§€μΌλ‚Ό μ μμ„μ§€λ„ λ§¤μ° μ¤‘μ”ν• κ³ λ―Ό ν¬μΈνΈμ΄λ‹¤.

κ°€λ Ή, λ΅κ·ΈμΈ κΈ°λ¥μ„ κµ¬ν„ν–λ‹¤κ³  κ°€μ •ν•΄λ³΄μ.

`Client` μ—μ„λ” μ μ €μ `id` μ™€ `password` λ¥Ό λ°›μ€ λ’¤, `payload` μ— λ‹΄μ•„ λ΅κ·ΈμΈ API λ¥Ό νΈμ¶ν•  κ²ƒμ΄λ‹¤.

λ³΄ν†µ μ•„λμ™€ κ°™μ΄ λΉ„λ°€λ²νΈμ™€ κ°™μ€ λ―Όκ°μ •λ³΄λ“¤μ€ `masking` μ²λ¦¬λμ–΄ λ³΄μ—¬μ§€κ² μ§€λ§

<img width="364" alt="image" src="https://github.com/versatile0010/versatile0010.github.io/assets/96612168/0f058b69-22e5-45d3-aacb-aa0210cc1431">

λ³„λ„μ λ³΄μ•μ μΈ μ²λ¦¬λ¥Ό ν•μ§€ μ•μΌλ©΄ κ°λ°μλ„κµ¬μ `payload` μ—μ„ `rawdata` κ°€ μ „λ¶€ λ…Έμ¶λλ‹¤.

λ°λ€λ΅ μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ •λ³΄λ¥Ό λ‚΄λ ¤μ¤„ λ•, λ³΄μ•μ²λ¦¬λ¥Ό μ‹ κ²½μ“°μ§€ μ•μΌλ©΄

`response` νƒ­μ—μ„ λ…Έμ¶λλ©΄ μ•λ  μ •λ³΄κ°€ κ·Έλ€λ΅ λ…Έμ¶λ  μ μλ‹¤.

μ΄λ¬ν• μƒν™©μ„ μΈμ§€ν•κ² λλ‹¤λ©΄ κ³ κ°μ€ μ°λ¦¬ μ„λΉ„μ¤λ¥Ό λ―Ώκ³  μ‚¬μ©ν•μ§€ λ»ν•  μ μκ³ ,

κ³„μ† λ°©μΉλλ‹¤λ©΄ κ°€λ¥μ„±μ΄ λ‚®λ”λΌλ„ μ‹¬κ°ν• λ¬Έμ κ°€ λ°μƒν•  μλ„ μλ‹¤.

---

### μ–΄λ–»κ² ν•΄κ²°ν•  μ μμ„κΉ?

μ‚¬μ‹¤ ν•΄κ²°λ²•μ€ μ‰½κ² λ– μ¬λ¦΄ μ μλ‹¤.

λ―Όκ°ν• μ •λ³΄λ” μ  3μκ°€ μ• μ μ—†λ„λ΅ μ•”νΈν™” μ²λ¦¬ν•λ©΄ λλ‹¤.

λ¬ν”„ν•κ² μ”κµ¬μ‚¬ν•­μ„ μ •λ¦¬ν•΄λ³΄μ.

- ν΄λΌμ΄μ–ΈνΈμ—μ„ λ―Όκ° μ •λ³΄λ¥Ό μ„λ²„λ΅ λ³΄λ‚Ό λ•μ—λ” μ•”νΈν™”ν•κ³ , μ„λ²„μ—μ„ λ³µνΈν™”ν• λ’¤ λ΅μ§μ„ μν–‰ν•μ.

μ„ μ”κµ¬μ‚¬ν•­μ„ λ§μ΅±ν•  μ μλ‹¤λ©΄ κΈ°μ΅΄μ— μ κΈ°ν• λ¬Έμ λ” ν•΄κ²°λ  κ²ƒμ΄λ‹¤.

λ¬Έμ κ°€ μ •μλμ—μΌλ‹, μ–΄λ–¤ λ„κµ¬λ΅ μ΄λ¥Ό ν•΄κ²°ν•  μ§€ κ³ λ―Όν•΄λ³΄μ.

---

### μ–΄λ–¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•  κ²ƒμΈκ°€?

μ•”νΈν™” μ•κ³ λ¦¬μ¦μ€ ν¬κ² μ•„λμ™€ κ°™μ΄ λ¶„λ¥λλ‹¤.

```java
1. λ‹¨λ°©ν–¥ μ•”νΈν™”
2. λ€μΉ­ν‚¤ μ•”νΈν™”
3. λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”
```
λ‹¨λ°©ν–¥ μ•”νΈν™”λ” `plain text` λ¥Ό `hashing` μ²λ¦¬ν•λ©°, λ³µνΈν™”λ¥Ό ν•  μ μ—†κΈ° λ•λ¬Έμ— `password` μ•”νΈν™”μ— μ£Όλ΅ μ‚¬μ©λλ‹¤.

μ°λ¦¬κ°€ μ •μν• μ”κµ¬μ‚¬ν•­μ„ λ§μ΅±ν•λ ¤λ©΄ λ³µνΈν™”κ°€ κ°€λ¥ν•΄μ•Ό ν•λ―€λ΅ `λ‹¨λ°©ν–¥ μ•”νΈν™”` λ” ν›„λ³΄μ—μ„ μ μ™Έν•λ‹¤.

λ‹¤μμ€ λ€μΉ­ν‚¤ μ•”νΈν™”, λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”μ΄λ‹¤.

λ¬ν”„ν•κ² μ„¤λ…ν•λ©΄,

- λ€μΉ­ν‚¤ μ•”νΈν™”λ” μ•”νΈν™” ν•  λ• μ‚¬μ©ν• key λ΅λ§ λ³µνΈν™”κ°€ κ°€λ¥ν•λ‹¤.


<img width="442" alt="image" src="https://github.com/versatile0010/versatile0010.github.io/assets/96612168/6d2c49a4-292b-4bd9-a437-7462acb63c8a">



λ€ν‘μ μΌλ΅ AES μ•”νΈν™” μ•κ³ λ¦¬μ¦μ΄ μλ‹¤.


- λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λ” μ•”νΈν™” ν•  λ• μ‚¬μ©ν• key μ™€ λ³µνΈν™”ν•  λ• μ‚¬μ©κ°€λ¥ν• key λ¥Ό μ„λ΅ λ‹¤λ¥΄κ² ν•  μ μλ‹¤.


<img width="441" alt="image" src="https://github.com/versatile0010/versatile0010.github.io/assets/96612168/ff7cbb58-2e2c-4646-95ba-2d6d2ab77c25">


λ€ν‘μ μΌλ΅ RSA μ•”νΈν™” μ•κ³ λ¦¬μ¦μ΄ μλ‹¤.

λ€μΉ­ν‚¤ μ•”νΈν™”μ™€ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λ” λ‘λ‹¤ λ³µνΈν™”κ°€ κ°€λ¥ν•λ‹¤.

λ‘ μ¤‘ μ–΄λ μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•λ” κ² μΆ‹μ„κΉ?

κµ¬ν„ λ‚μ΄λ„λ” λ€μΉ­ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΈ AES κ°€ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΈ RSA λ³΄λ‹¤ ν›¨μ”¬ μ©μ΄ν•λ‹¤.

- ( μ‹¬μ§€μ–΄ ν”„λ΅μ νΈ λ‚΄μ— AES Utility ν΄λμ¤κ°€ κµ¬ν„λμ–΄ μμ—κΈ° λ•λ¬Έμ— κ·Έλƒ¥ κ°€μ Έλ‹¤κ°€ μ‚¬μ©ν•λ©΄ λλ” μƒν™©μ΄μ—λ‹¤. )

κ·ΈλΌμ—λ„ RSA μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ μ„ νƒν•μ€λ”λ°, κ·Έ μ΄μ λ” μ•„λμ™€ κ°™λ‹¤.

```java
1. λ€μΉ­ν‚¤ μ•”νΈν™”(AES)λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ key λ¥Ό κ³µμ ν•΄μ•Ό ν•λ‹¤. Server side μ—μ„λ” db μ²λ¦¬λ¥Ό ν•΄μ„ κ°€μ§€κ³  μμΌλ©΄ λμ§€λ§ Client side μ—μ„λ” key λ¥Ό μ•μ „ν•κ² μ €μ¥ν•  κ³³μ΄ λ§λ•…μΉ μ•λ‹¤. 
2. λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”(RSA)λ¥Ό μ‚¬μ©ν•λ©΄ κ°™μ€ key λ¥Ό κ³µμ ν•  ν•„μ”κ°€ μ—†μ–΄μ§„λ‹¤. μ•”νΈν™”λ” λ„κµ¬λ‚ ν•  μ μμ§€λ§, λ³µνΈν™”λ” λ§μλ€λ΅ ν•μ§€ λ»ν•κ² ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ‹¤.
```

μ΄κΈ°μ— μ •μν• μ”κµ¬μ‚¬ν•­μ„ RSA μ•”νΈν™”λ΅ ν•΄κ²°ν•  μ μλ”μ§€ ν™•μΈν•΄λ³΄μ.

- ν΄λΌμ΄μ–ΈνΈμ—μ„ λ―Όκ° μ •λ³΄λ¥Ό μ„λ²„λ΅ λ³΄λ‚Ό λ•μ—λ” μ•”νΈν™”ν•κ³ , μ„λ²„μ—μ„ λ³µνΈν™”ν• λ’¤ λ΅μ§μ„ μν–‰ν•μ.
  - ν΄λΌμ΄μ–ΈνΈμ—μ„ public key λ΅ μ•”νΈν™”ν•μ—¬ μ„λ²„μ— μ”μ²­ν•λ©΄, μ„λ²„μ—μ„λ” ν•΄λ‹Ή public key μ— λ€ν• private key λ¥Ό μ•κ³ μμΌλ©΄, κ°€λ¥ν•λ‹¤.


μ¦‰, `ν΄λΌμ΄μ–ΈνΈμ—μ„ public key λ΅ μ•”νΈν™”ν•μ—¬ μ„λ²„μ— μ”μ²­ν•λ©΄, μ„λ²„μ—μ„λ” ν•΄λ‹Ή public key μ— λ€ν• private key λ¥Ό μ•κ³ μμΌλ©΄` λλ‹¤.

κ·ΈλΌ μ–΄λ–»κ² ν•  μ μμ„κΉ?

κΈ°λ³Έμ μΌλ΅ `RSA keypair` λ” μ•μ „ν•κ² μ„λ²„μ—μ„ κ΄€λ¦¬ν•λ” κ² μΆ‹μ•„λ³΄μΈλ‹¤.

κ·ΈλΌ μ•„λμ™€ κ°™μ΄ ν•λ©΄ μ–΄λ–¨κΉ?

1. ν΄λΌμ΄μ–ΈνΈμ—μ„ μ•”νΈν™” ν•  μΌμ΄ μƒκΈ΄λ‹¤λ©΄ μ„λ²„λ΅ `RSA public key` λ¥Ό ν•λ‚ μ”μ²­ν•λ‹¤.
2. μ„λ²„μ—μ„ `RSA Keypair` λ¥Ό ν•λ‚ μƒμ„±ν•κ³ , `public key` λ¥Ό λ‚΄λ ¤μ¤€λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈμ—μ„ `public key` λ΅ μ•”νΈν™”λ¥Ό μν–‰ν• λ’¤, `public key` μ™€ ν•¨κ» μ•”νΈλ¬Έμ„ μ„λ²„λ΅ λ³΄λ‚Έλ‹¤.
   - μ΄ κ³Όμ •μ—μ„ μ  3 μκ°€ νƒμ·¨ν•λ”λΌλ„ `public key` μ— λ§¤μΉ­λλ” `private key` λ¥Ό λ¨λ¥΄λ‹ μ•μ „ν•λ‹¤.
4. μ„λ²„μ—μ„λ” `public key` μ— λ§¤μΉ­λλ” `private key` λ¥Ό μ°Ύμ•„μ„ λ³µνΈν™”ν• λ’¤ λ΅μ§μ„ μν–‰ν•λ’¤μ— ν•΄λ‹Ή `key pair` λ¥Ό μ κ±°ν•λ‹¤.


μ΄λ¥Ό μ„ν•΄μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ•”νΈν™” ν• `public key` μ— λ€ν• `private key` λ¥Ό μ΅°νν•  μ μμ–΄μ•Ό ν•λ‹¤.

rdb μ— μ €μ¥ν•΄λ‘ μλ„ μκ² μ§€λ§, μΈλ©”λ¨λ¦¬ κΈ°λ°μΌλ΅ λ” λΉ λ¥Έ I/O λ¥Ό μ κ³µν•λ©°

ttl μ„ μ§€μ •ν• μλ„ μκ³  public key μ— λ€ν• private key λ¥Ό μ°Ύλ” μ—°μ‚°μ΄

μμ£Ό λ°μƒν•  κ²ƒμΌλ΅ μμƒλλ”λ°, 

key-value ν•μ‹μ data storage μΈ `redis` κ°€ λ” μ ν•©ν•λ‹¤κ³  νλ‹¨ν•μ€λ‹¤.

ν•μ§€λ§, ν•λ‚λ§ λ” κ³ λ ¤ν•΄λ³΄μ.

μ„ λ°©λ²•λ€λ΅λ©΄ μ”μ²­λ§λ‹¤ μ„λ²„μ—μ„ `RSA Keypair` λ¥Ό μƒμ„±ν•΄μ•Ό ν•λ‹¤.

κ·Έλ ‡κ² ν•΄λ„ κ΄μ°®μ„ λ§νΌ `RSA Keypair μƒμ„± μ—°μ‚°μ΄ κ°€λ²Όμ΄ μ§€` μ°Ύμ•„λ³Έ κ²°κ³Ό,

```java
Finding two large prime numbers	
  : O((log n)^2)
Computing the modulus	
  : O(log^2 n)
Computing modular inverses	
  : O(log^3 n)
Total
  : O((log n)^3)
```
λ€λµ `O((log n)^3)` μ •λ„μΈ κ²ƒ κ°™λ‹¤. ( n = 1024, 2048, ... )

κµ³μ΄ λ§¤ μ”μ²­λ§λ‹¤ `RSA Keypair` λ¥Ό μƒλ΅ μƒμ„±ν•΄λ„λ΅ ν•΄μ•Όν• κΉ?

`Thread pool` μ²λΌ `RSA Keypair` λ¥Ό μ—¬λ¬κ° μ„λ²„μ—μ„ λ―Έλ¦¬ λ§λ“¤μ–΄λ‘κ³ 

ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄ ν•λ‚ λλ¤ν•κ² `pick` ν•΄μ„ λ‚΄λ ¤μ£Όλ” λ°©λ²•μ€ μ–΄λ–¨κΉ?

κ·Έλ¬λ©΄ RSA Keypair λ¥Ό λ§¤λ² μƒλ΅­κ² λ§λ“λ” λ°μ— λ°μƒν•λ” cost λ¥Ό μ κ±°ν•  μ μλ‹¤.

<img width="1015" alt="image" src="https://github.com/versatile0010/versatile0010.github.io/assets/96612168/ec6ccf90-dbef-4fbf-bbda-7b7ece012da2">


1. ν΄λΌμ΄μ–ΈνΈμ—μ„ μ•”νΈν™” ν•  μΌμ΄ μƒκΈ΄λ‹¤λ©΄ μ„λ²„λ΅ `RSA public key` λ¥Ό ν•λ‚ μ”μ²­ν•λ‹¤.
2. μ„λ²„μ—μ„λ” λ―Έλ¦¬ μƒμ„±ν•΄λ‘” `RSA Keypair` μ¤‘ ν•λ‚λ¥Ό κ³¨λΌμ„, `public key` λ¥Ό λ‚΄λ ¤μ¤€λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈμ—μ„ `public key` λ΅ μ•”νΈν™”λ¥Ό μν–‰ν• λ’¤, `public key` μ™€ ν•¨κ» μ•”νΈλ¬Έμ„ μ„λ²„λ΅ λ³΄λ‚Έλ‹¤. 
   - μ΄ κ³Όμ •μ—μ„ μ  3 μκ°€ νƒμ·¨ν•λ”λΌλ„ `public key` μ— λ§¤μΉ­λλ” `private key` λ¥Ό λ¨λ¥΄λ‹ μ•μ „ν•λ‹¤.
4. μ„λ²„μ—μ„λ” `public key` μ— λ§¤μΉ­λλ” `private key` λ¥Ό μ°Ύμ•„μ„ λ³µνΈν™”ν•μ—¬ μ΄ν›„ λ΅μ§μ„ μν–‰ν•λ‹¤.


ν•μ§€λ§ λ.. ν•λ‚ λ” κ³ λ ¤ν•΄μ•Όν•  μ μ΄ μλ‹¤.

μ„ λ΅μ§μ€ Redis μ— μƒλ‹Ήν• μμ΅΄λ„λ¥Ό κ°€μ§„λ‹¤.

λ§μ•½ Redis μ„λ²„κ°€ λ‹¤μ΄λλ‹¤λ©΄?

μ΄μ— λ€ν• κ³ λ ¤κ°€ μ „ν€ λμ–΄ μμ§€ μ•μΌλ―€λ΅, Redis λ¥Ό μ‚¬μ©ν•λ” API μ—μ„ λ¨λ‘ μ¥μ• κ°€ λ°μƒν•  κ²ƒμ΄λ‹¤.

Redis μ„λ²„κ°€ λ‹¤μ΄λλ” μƒν™©μ΄ ν”μΉ μ•λ‹¤κ³ λ” ν•μ§€λ§ κ°€λ¥μ„±μ΄ μ—†λ” κ²ƒμ€ μ•„λ‹λ‹¤.

μ΄λ¬ν• μƒν™©κΉμ§€ μ»¤λ²„ν•λ ¤λ©΄ μ–΄λ–»κ² ν•΄μ•Όν• κΉ?

Redis μ„λ²„κ°€ μ •μƒμ μ΄μ§€ μ•μ€ κ²½μ°μ— λ€ν•΄μ„λ„ μ λ™μ‘ν•  μ μλ„λ΅

λ³„λ„μ fallback μ„ νλ‘μ–΄μ•Ό ν•λ‹¤.

μ΄λ¥Ό `Circuit breaker` μ΄λΌκ³  ν•λ©°, ν•΄λ‹Ή λ‚΄μ©μ€ λ³„λ„μ ν¬μ¤ν…μ—μ„ λ‹¤λ£¨λ ¤κ³  ν•λ‹¤.

---
## References
- https://www.baeldung.com/java-rsa
- https://www.geeksforgeeks.org/how-to-generate-large-prime-numbers-for-rsa-algorithm/
- https://dev.gmarket.com/47